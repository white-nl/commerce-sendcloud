{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}

{% set fullPageForm = allowAdminChanges %}

{% set title = "{pluginName} Settings"|t('commerce-sendcloud', {pluginName: plugin.name}) %}
{% set docTitle = title ~ ' - ' ~ "Plugins"|t('app') %}
{% set crumbs = [
    { label: "Settings"|t('app'), url: url('settings') },
    { label: "Plugins"|t('app'), url: url('settings/plugins') }
] %}
{% set selectedSubnavItem = 'settings' %}

{% set tabs = [
    { label: 'Order Sync'|t('commerce-sendcloud'), url: '#settings-order-sync' },
    { label: 'Advanced'|t('commerce-sendcloud'), url: '#settings-advanced' },
] %}

{% block actionButton %}
    {% if allowAdminChanges %}
        {{ parent() }}
    {% endif %}
{% endblock actionButton %}

{% set adminChangesWarning %}
    {% if not allowAdminChanges %}
        <div class="pane">
            <p class="warning">
                {{ "You're not allowed to change system settings. Some of the settings have been disabled."|t('commerce-sendcloud') }}
            </p>
        </div>
    {% endif %}
{% endset %}


{% block content %}
    {{ actionInput('plugins/save-plugin-settings') }}
    {{ hiddenInput('pluginHandle', plugin.handle) }}
    {{ redirectInput('commerce-sendcloud/settings') }}

    {% namespace 'settings' %}
        <div id="fields">
            <div>
                <div id="order-sync">
                    {{ adminChangesWarning }}
                    <h3>{{ "International shipping"|t('commerce-sendcloud') }}</h3>
                    {{ forms.selectField({
                        label: "HS Code field mapping"|t('commerce-sendcloud'),
                        instructions: "Select the Craft Commerce product field containing the HS product codes. HS codes are required for shipping outside the EU."|t('commerce-sendcloud'),
                        id: "hsCodeFieldHandle",
                        name: "hsCodeFieldHandle",
                        options: settings.getAvailableTextFields(),
                        value: settings.hsCodeFieldHandle,
                        errors: settings.getErrors('hsCodeFieldHandle'),
                        disabled: not allowAdminChanges,
                    }) }}
                    {{ forms.selectField({
                        label: "Country of Origin field mapping"|t('commerce-sendcloud'),
                        instructions: "Select the Craft Commerce product field containing the country of Origin. Use only ISO2 country codes!"|t('commerce-sendcloud'),
                        id: "originCountryFieldHandle",
                        name: "originCountryFieldHandle",
                        options: settings.getAvailableTextFields(),
                        value: settings.originCountryFieldHandle,
                        errors: settings.getErrors('originCountryFieldHandle'),
                        disabled: not allowAdminChanges,
                    }) }}
                    <h3>{{ "Address fields"|t('commerce-sendcloud') }}</h3>
                    {{ forms.selectField({
                        label: "Phone number field"|t('commerce-sendcloud'),
                        instructions: "Select the Craft field linked to the Address element containing the phone number"|t('commerce-sendcloud'),
                        id: "phoneNumberFieldHandle",
                        name: "phoneNumberFieldHandle",
                        options: settings.getAvailableTextFields(),
                        value: settings.phoneNumberFieldHandle,
                        errors: settings.getErrors('phoneNumberFieldHandle'),
                        disabled: not allowAdminChanges,
                    }) }}
                </div>
                <div id="advanced" class="hidden">
                    {{ adminChangesWarning }}

                    {{ forms.textField({
                        label: "Plugin name"|t('commerce-sendcloud'),
                        instructions: "The plugin name as you'd like it to be displayed in the Control Panel."|t('commerce-sendcloud'),
                        id: "pluginNameOverride",
                        name: "pluginNameOverride",
                        value: settings.pluginNameOverride,
                        errors: settings.getErrors('pluginNameOverride'),
                        disabled: not allowAdminChanges,
                    }) }}

                </div>
            </div>
        </div>
    {% endnamespace %}
{% endblock content %}
