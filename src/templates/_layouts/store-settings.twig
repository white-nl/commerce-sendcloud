{% extends "_layouts/cp" %}

{% set selectedSubnavItem = 'store-settings' %}
{% if selectedItem is not defined %}
    {% set selectedItem = craft.app.request.getSegment((craft.app.config.general.cpTrigger ? 4 : 3)) ?? 'integration' %}
{% endif %}
{% if storeHandle is not defined %}
    {% set storeHandle = craft.app.request.getSegment((craft.app.config.general.cpTrigger ? 3 : 2)) ?? craft.commerce.stores.getPrimaryStore().handle %}
{% endif %}
{% set store = craft.commerce.stores.getStoreByHandle(storeHandle) %}

{% set title = title is not defined ? 'Store Settings'|t('commerce-sendcloud') : title %}

{% block toolbar %}
    {% if craft.commerce.stores.getAllStores().count() > 1 %}
        <div class="btn menubtn sitemenbtn store-selector">
            <select id="store-selector">
                {% for storeOption in craft.commerce.stores.getAllStores() %}
                    {# Include `store-settings` in the replace to avoid accidentally overrding another part of the URL #}
                    <option value="{{ craft.app.request.url|replace('store-settings/' ~ storeHandle, 'store-settings/' ~ storeOption.handle) }}" {% if store.id == storeOption.id %}selected{% endif %}>{{ storeOption.name }}</option>
                {% endfor %}
            </select>
        </div>
    {% endif %}
{% endblock %}
{% block sidebar %}
    <nav>
        <ul>
            <li>
                <a href="{{ url('commerce-sendcloud/store-settings/' ~ storeHandle) }}"{% if selectedItem == 'integration' %} class="sel"{% endif %}>{{ "Integration"|t('commerce-sendcloud') }}</a>
            </li>
            <li>
                <a href="{{ url('commerce-sendcloud/store-settings/' ~ storeHandle ~ '/shipping-methods') }}"{% if selectedItem == 'shipping-methods' %} class="sel"{% endif %}>{{ "Shipping Methods"|t('commerce-sendcloud') }}</a>
            </li>
        </ul>
    </nav>
{% endblock %}

{% js %}
$('#store-selector').on('change', function() {
    var storeUrl = $(this).val();
    window.location.href = storeUrl;
});
{% endjs %}